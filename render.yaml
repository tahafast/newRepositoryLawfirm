services:
  - type: web
    name: brag-legal-api
    env: python
    plan: free         # or starter
    region: oregon     # pick your region
    buildCommand: pip install -r requirements.txt
    startCommand: uvicorn app.main:app --host 0.0.0.0 --port $PORT --proxy-headers
    healthCheckPath: /healthz
    autoDeploy: true
    envVars:
      - key: SERVE_FRONTEND
        value: "1"             # serves /ui from ./frontend
      - key: LOG_LEVEL
        value: INFO
      # === Qdrant Cloud (fill these in the dashboard as "From dashboard" if you prefer secrets) ===
      - key: QDRANT_MODE
        value: cloud
      - key: QDRANT_URL         # e.g. https://xxxx-xxx.gcp.cloud.qdrant.io
        sync: https://9c1cc1f3-92a0-461d-bec1-a8d6813696d3.us-east4-0.gcp.cloud.qdrant.io:6333
      - key: QDRANT_API_KEY
        sync: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhY2Nlc3MiOiJtIn0.22A1dUFI4HldggwcNp_TDV8wlHhAEj9M9zK6fFdct6I
      - key: QDRANT_COLLECTION
        value: law_docs_v1
      - key: QDRANT_COLLECTION_ALIAS
        value: law_docs_current
      - key: EPHEMERAL_COLLECTION_PREFIX
        value: ephemeral_docs
      - key: EMBEDDING_DIM
        value: "1536"
      - key: VECTOR_DISTANCE
        value: Cosine
      # Optional web search
      - key: TAVILY_API_KEY
        sync: from-dashboard
      - key: WEB_SEARCH_ENABLED
        value: "true"
